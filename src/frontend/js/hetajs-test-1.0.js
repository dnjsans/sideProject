!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.hetajs={})}(this,function(t){"use strict";var e=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i={basic:{uniform:[],vs:"attribute vec2 a_position;\r\nattribute vec2 a_texCoord;\r\n\r\nvarying vec2 v_texCoord;\r\nvoid main(){\r\n\tgl_Position = vec4(a_position, 1.0, 1.0);\r\n\tv_texCoord = a_texCoord;\r\n}\r\n",fs:"precision mediump float;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_texCoord;\r\n\r\nvoid main(){\r\n\tgl_FragColor = texture2D(u_image, v_texCoord);\r\n}\r\n"}},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in s)return s.value;var r=s.get;return void 0!==r?r.call(n):void 0},r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(){function t(e){n(this,t),this.gl=e,this.getProgram()}return s(t,[{key:"getProgram",value:function(){var t=this.gl,e=this._getShader(i.basic.vs,"VERTEX"),n=this._getShader(i.basic.fs,"FRAGMENT");if(e&&n){if(this.program=t.createProgram(),t.attachShader(this.program,e),t.attachShader(this.program,n),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.log("Error Linking PROGRAM :"+t.getProgramInfoLog(this.program)),null;if(t.validateProgram(this.program),!t.getProgramParameter(this.program,t.VALIDATE_STATUS))return console.log("Error Validating PROGRAM :"+t.getProgramInfoLog(this.program)),null;t.detachShader(this.program,e),t.detachShader(this.program,n),t.deleteShader(e),t.deleteShader(n),t.useProgram(null)}}},{key:"_getShader",value:function(t,e){var i=this.gl,n=i.VERTEX_SHADER;"FRAGMENT"===e&&(n=i.FRAGMENT_SHADER);var s=i.createShader(n);return i.shaderSource(s,t),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(console.log("Error "+e+" Shader :"+i.getShaderInfoLog(s)),null)}}]),t}(),u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.isVec3=!0,this.x=e,this.y=i,this.z=s}return s(t,[{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clamp",value:function(t,e){return this.x=Math.min(e.x,Math.max(t.x,this.x)),this.y=Math.min(e.y,Math.max(t.y,this.y)),this.z=Math.min(e.z,Math.max(t.z,this.z)),this}},{key:"angleTo",value:function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z,i=t.x*t.x+t.y*t.y+t.z*t.z,n=this.dot(t)/Math.sqrt(e*i);return Math.acos(Math.min(1,Math.max(-1,n)))}},{key:"distanceTo",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)}},{key:"dot",value:function(t){return t.x*this.x+t.y*this.y+t.z*this.z}},{key:"cross",value:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this}},{key:"crossVec",value:function(t,e){var i=t.x,n=t.y,s=t.z;return this.x=n*e.z-s*e.y,this.y=s*e.x-i*e.z,this.z=i*e.y-n*e.x,this}},{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"add",value:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t,e){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t,e){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele,o=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*o,this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z,h=t.w,a=h*e+o*n-r*i,u=h*i+r*e-s*n,c=h*n+s*i-o*e,l=-s*e-o*i-r*n;return this.x=a*h+l*-s+u*-r-c*-o,this.y=u*h+l*-o+c*-s-a*-r,this.z=c*h+l*-r+a*-o-u*-s,this}},{key:"transformDirection",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clampScalar",value:function(e,i){return this.clamp(new t(e,e,e),new t(i,i,i))}},{key:"clampLength",value:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"projectOnVector",value:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixPosition",value:function(t){var e=t.ele;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.ele,4*e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}]),t}(),c=function(){function t(){n(this,t),this.isMat4=!0,this.ele=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.lookVecX=new u,this.lookVecY=new u,this.lookVecZ=new u,this.vecApplyBuff=new u,this.extractRotVec=new u}return s(t,[{key:"set",value:function(t,e,i,n,s,o,r,h,a,u,c,l,y,v,f,_){var x=this.ele;return x[0]=t,x[4]=e,x[8]=i,x[12]=n,x[1]=s,x[5]=o,x[9]=r,x[13]=h,x[2]=a,x[6]=u,x[10]=c,x[14]=l,x[3]=y,x[7]=v,x[11]=f,x[15]=_,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new t).fromArray(this.ele)}},{key:"copy",value:function(t){var e=this.ele,i=t.ele;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"copyPosition",value:function(t){var e=this.ele,i=t.ele;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}},{key:"extractBasis",value:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.extractRotVec,i=this.ele,n=t.ele,s=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),r=1/e.setFromMatrixColumn(t,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*r,i[9]=n[9]*r,i[10]=n[10]*r,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.ele,i=t.x,n=t.y,s=t.z,o=Math.cos(i),r=Math.sin(i),h=Math.cos(n),a=Math.sin(n),u=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){var l=o*u,y=o*c,v=r*u,f=r*c;e[0]=h*u,e[4]=-h*c,e[8]=a,e[1]=y+v*a,e[5]=l-f*a,e[9]=-r*h,e[2]=f-l*a,e[6]=v+y*a,e[10]=o*h}else if("YXZ"===t.order){var _=h*u,x=h*c,p=a*u,d=a*c;e[0]=_+d*r,e[4]=p*r-x,e[8]=o*a,e[1]=o*c,e[5]=o*u,e[9]=-r,e[2]=x*r-p,e[6]=d+_*r,e[10]=o*h}else if("ZXY"===t.order){var _=h*u,x=h*c,p=a*u,d=a*c;e[0]=_-d*r,e[4]=-o*c,e[8]=p+x*r,e[1]=x+p*r,e[5]=o*u,e[9]=d-_*r,e[2]=-o*a,e[6]=r,e[10]=o*h}else if("ZYX"===t.order){var l=o*u,y=o*c,v=r*u,f=r*c;e[0]=h*u,e[4]=v*a-y,e[8]=l*a+f,e[1]=h*c,e[5]=f*a+l,e[9]=y*a-v,e[2]=-a,e[6]=r*h,e[10]=o*h}else if("YZX"===t.order){var m=o*h,k=o*a,g=r*h,z=r*a;e[0]=h*u,e[4]=z-m*c,e[8]=g*c+k,e[1]=c,e[5]=o*u,e[9]=-r*u,e[2]=-a*u,e[6]=k*c+g,e[10]=m-z*c}else if("XZY"===t.order){var m=o*h,k=o*a,g=r*h,z=r*a;e[0]=h*u,e[4]=-c,e[8]=a*u,e[1]=m*c+z,e[5]=o*u,e[9]=k*c-g,e[2]=g*c-k,e[6]=r*u,e[10]=z*c+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var e=this.ele,i=t._x,n=t._y,s=t._z,o=t._w,r=i+i,h=n+n,a=s+s,u=i*r,c=i*h,l=i*a,y=n*h,v=n*a,f=s*a,_=o*r,x=o*h,p=o*a;return e[0]=1-(y+f),e[4]=c-p,e[8]=l+x,e[1]=c+p,e[5]=1-(u+f),e[9]=v-_,e[2]=l-x,e[6]=v+_,e[10]=1-(u+y),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"lookAt",value:function(t,e,i){var n=this.ele,s=this.lookVecX,o=this.lookVecY,r=this.lookVecZ;return r.subVectors(t,e),0===r.lengthSq()&&(r.z=1),r.normalize(),s.crossVectors(i,r),0===s.lengthSq()&&(1===Math.abs(i.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),s.crossVectors(i,r)),s.normalize(),o.crossVectors(r,s),n[0]=s.x,n[4]=o.x,n[8]=r.x,n[1]=s.y,n[5]=o.y,n[9]=r.y,n[2]=s.z,n[6]=o.z,n[10]=r.z,this}},{key:"multiply",value:function(t,e){return null!=e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var i=t.ele,n=e.ele,s=this.ele,o=i[0],r=i[4],h=i[8],a=i[12],u=i[1],c=i[5],l=i[9],y=i[13],v=i[2],f=i[6],_=i[10],x=i[14],p=i[3],d=i[7],m=i[11],k=i[15],g=n[0],z=n[4],M=n[8],S=n[12],w=n[1],b=n[5],C=n[9],R=n[13],P=n[2],E=n[6],A=n[10],O=n[14],T=n[3],D=n[7],I=n[11],L=n[15];return s[0]=o*g+r*w+h*P+a*T,s[4]=o*z+r*b+h*E+a*D,s[8]=o*M+r*C+h*A+a*I,s[12]=o*S+r*R+h*O+a*L,s[1]=u*g+c*w+l*P+y*T,s[5]=u*z+c*b+l*E+y*D,s[9]=u*M+c*C+l*A+y*I,s[13]=u*S+c*R+l*O+y*L,s[2]=v*g+f*w+_*P+x*T,s[6]=v*z+f*b+_*E+x*D,s[10]=v*M+f*C+_*A+x*I,s[14]=v*S+f*R+_*O+x*L,s[3]=p*g+d*w+m*P+k*T,s[7]=p*z+d*b+m*E+k*D,s[11]=p*M+d*C+m*A+k*I,s[15]=p*S+d*R+m*O+k*L,this}},{key:"multiplyScalar",value:function(t){var e=this.ele;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"applyToBufferAttribute",value:function(t){for(var e=this.vecApplyBuff,i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}},{key:"determinant",value:function(){var t=this.ele,e=t[0],i=t[4],n=t[8],s=t[12],o=t[1],r=t[5],h=t[9],a=t[13],u=t[2],c=t[6],l=t[10],y=t[14];return t[3]*(+s*h*c-n*a*c-s*r*l+i*a*l+n*r*y-i*h*y)+t[7]*(+e*h*y-e*a*l+s*o*l-n*o*y+n*a*u-s*h*u)+t[11]*(+e*a*c-e*r*y-s*o*c+i*o*y+s*r*u-i*a*u)+t[15]*(-n*r*u-e*h*c+e*r*l+n*o*c-i*o*l+i*h*u)}},{key:"transpose",value:function(){var t,e=this.ele;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setPosition",value:function(t){var e=this.ele;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"getInverse",value:function(t,e){var i=this.ele,n=t.ele,s=n[0],o=n[1],r=n[2],h=n[3],a=n[4],u=n[5],c=n[6],l=n[7],y=n[8],v=n[9],f=n[10],_=n[11],x=n[12],p=n[13],d=n[14],m=n[15],k=v*d*l-p*f*l+p*c*_-u*d*_-v*c*m+u*f*m,g=x*f*l-y*d*l-x*c*_+a*d*_+y*c*m-a*f*m,z=y*p*l-x*v*l+x*u*_-a*p*_-y*u*m+a*v*m,M=x*v*c-y*p*c-x*u*f+a*p*f+y*u*d-a*v*d,S=s*k+o*g+r*z+h*M;if(0===S){var w="Matrix4 .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(w);return console.warn(w),this.identity()}var b=1/S;return i[0]=k*b,i[1]=(p*f*h-v*d*h-p*r*_+o*d*_+v*r*m-o*f*m)*b,i[2]=(u*d*h-p*c*h+p*r*l-o*d*l-u*r*m+o*c*m)*b,i[3]=(v*c*h-u*f*h-v*r*l+o*f*l+u*r*_-o*c*_)*b,i[4]=g*b,i[5]=(y*d*h-x*f*h+x*r*_-s*d*_-y*r*m+s*f*m)*b,i[6]=(x*c*h-a*d*h-x*r*l+s*d*l+a*r*m-s*c*m)*b,i[7]=(a*f*h-y*c*h+y*r*l-s*f*l-a*r*_+s*c*_)*b,i[8]=z*b,i[9]=(x*v*h-y*p*h-x*o*_+s*p*_+y*o*m-s*v*m)*b,i[10]=(a*p*h-x*u*h+x*o*l-s*p*l-a*o*m+s*u*m)*b,i[11]=(y*u*h-a*v*h-y*o*l+s*v*l+a*o*_-s*u*_)*b,i[12]=M*b,i[13]=(y*p*r-x*v*r+x*o*f-s*p*f-y*o*d+s*v*d)*b,i[14]=(x*u*r-a*p*r-x*o*c+s*p*c+a*o*d-s*u*d)*b,i[15]=(a*v*r-y*u*r+y*o*c-s*v*c-a*o*f+s*u*f)*b,this}},{key:"scale",value:function(t){var e=this.ele,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}},{key:"getMaxScaleOnAxis",value:function(){var t=this.ele,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}},{key:"makeTranslation",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,o=t.x,r=t.y,h=t.z,a=s*o,u=s*r;return this.set(a*o+i,a*r-n*h,a*h+n*r,0,a*r+n*h,u*r+i,u*h-n*o,0,a*h-n*r,u*h+n*o,s*h*h+i,0,0,0,0,1),this}},{key:"makeScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this}},{key:"makePerspective",value:function(t,e,i,n,s,o){var r=this.ele,h=2*s/(e-t),a=2*s/(i-n),u=(e+t)/(e-t),c=(i+n)/(i-n),l=-(o+s)/(o-s),y=-2*o*s/(o-s);return r[0]=h,r[4]=0,r[8]=u,r[12]=0,r[1]=0,r[5]=a,r[9]=c,r[13]=0,r[2]=0,r[6]=0,r[10]=l,r[14]=y,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}},{key:"makeOrthographic",value:function(t,e,i,n,s,o){var r=this.ele,h=1/(e-t),a=1/(i-n),u=1/(o-s),c=(e+t)*h,l=(i+n)*a,y=(o+s)*u;return r[0]=2*h,r[4]=0,r[8]=0,r[12]=-c,r[1]=0,r[5]=2*a,r[9]=0,r[13]=-l,r[2]=0,r[6]=0,r[10]=-2*u,r[14]=-y,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}},{key:"equals",value:function(t){for(var e=this.ele,i=t.ele,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<16;i++)this.ele[i]=t[i+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.ele;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}]),t}(),l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n(this,t),this._x=e,this._y=i,this._z=s,this._w=o,this.UnitVec3=new u,this.EPS=1e-6}return s(t,[{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"set",value:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this}},{key:"inverse",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,s=this._z,o=this._w,r=o*t._w+i*t._x+n*t._y+s*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;var h=Math.sqrt(1-r*r);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(s+this._z),this;var a=Math.atan2(h,r),u=Math.sin((1-e)*a)/h,c=Math.sin(e*a)/h;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=s*u+this._z*c,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(t,e){var i=t._x,n=t._y,s=t._z,o=t.order,r=Math.cos,h=Math.sin,a=r(i/2),u=r(n/2),c=r(s/2),l=h(i/2),y=h(n/2),v=h(s/2);return"XYZ"===o?(this._x=l*u*c+a*y*v,this._y=a*y*c-l*u*v,this._z=a*u*v+l*y*c,this._w=a*u*c-l*y*v):"YXZ"===o?(this._x=l*u*c+a*y*v,this._y=a*y*c-l*u*v,this._z=a*u*v-l*y*c,this._w=a*u*c+l*y*v):"ZXY"===o?(this._x=l*u*c-a*y*v,this._y=a*y*c+l*u*v,this._z=a*u*v+l*y*c,this._w=a*u*c-l*y*v):"ZYX"===o?(this._x=l*u*c-a*y*v,this._y=a*y*c+l*u*v,this._z=a*u*v-l*y*c,this._w=a*u*c+l*y*v):"YZX"===o?(this._x=l*u*c+a*y*v,this._y=a*y*c+l*u*v,this._z=a*u*v-l*y*c,this._w=a*u*c-l*y*v):"XZY"===o&&(this._x=l*u*c-a*y*v,this._y=a*y*c-l*u*v,this._z=a*u*v+l*y*c,this._w=a*u*c+l*y*v),!1!==e&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t){var e,i=t.elements,n=i[0],s=i[4],o=i[8],r=i[1],h=i[5],a=i[9],u=i[2],c=i[6],l=i[10],y=n+h+l;return y>0?(e=.5/Math.sqrt(y+1),this._w=.25/e,this._x=(c-a)*e,this._y=(o-u)*e,this._z=(r-s)*e):n>h&&n>l?(e=2*Math.sqrt(1+n-h-l),this._w=(c-a)/e,this._x=.25*e,this._y=(s+r)/e,this._z=(o+u)/e):h>l?(e=2*Math.sqrt(1+h-n-l),this._w=(o-u)/e,this._x=(s+r)/e,this._y=.25*e,this._z=(a+c)/e):(e=2*Math.sqrt(1+l-n-h),this._w=(r-s)/e,this._x=(o+u)/e,this._y=(a+c)/e,this._z=.25*e),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(t,e){var i=this.UnitVec3;return this.r=t.dot(e)+1,this.r<this.EPS?(this.r=0,Math.abs(t.x)>Math.abs(t.z)?i.set(-t.y,t.x,0):i.set(0,-t.z,t.y)):i.crossVectors(t,e),this._x=i.x,this._y=i.y,this._z=i.z,this._w=this.r,this.normalize()}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this.lengthSq())}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this}},{key:"multiply",value:function(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,e){var i=t._x,n=t._y,s=t._z,o=t._w,r=e._x,h=e._y,a=e._z,u=e._w;return this._x=i*u+o*r+n*a-s*h,this._y=n*u+o*h+s*r-i*a,this._z=s*u+o*a+i*h-n*r,this._w=o*u-i*r-n*h-s*a,this.onChangeCallback(),this}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}},{key:"onChange",value:function(t){return this.onChangeCallback=t,this}},{key:"onChangeCallback",value:function(){}}]),t}(),y=function(){function t(){n(this,t),this.type="Camera",this.isCamera=!0,this.matrixWorldInverse=new c,this.projectionMatrix=new c,this.quat=new l}return s(t,[{key:"copy",value:function(e,i){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"copy",this).call(this,this,e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getWorldDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new u,e=this.quat;return this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}},{key:"updateMatrixWorld",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)}}]),t}(),v=function(){function t(e){n(this,t),this.gl=e}return s(t,[{key:"Remove",value:function(t){}},{key:"Add",value:function(t){t instanceof y&&console.log("camera")}},{key:"Start",value:function(){}},{key:"Update",value:function(){}},{key:"Render",value:function(){}},{key:"Stop",value:function(){}},{key:"Resize",value:function(t){}}]),t}(),f=function(){function t(){n(this,t),this.active=!1,this.started=!1,window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()}return s(t,[{key:"Start",value:function(){var t=this;this.started=!0,this.active=!0,this._Updateloop=setInterval(function(){t._MainLoop()},40),function e(){requestAnimationFrame(e),t.active&&t._RenderLoop()}()}},{key:"Resume",value:function(){this.started=!0}},{key:"Pause",value:function(){this.started=!1}},{key:"Stop",value:function(){this.active=!1,clearInterval(this._Updateloop)}},{key:"_MainLoop",value:function(){this.started&&this.Update()}},{key:"_RenderLoop",value:function(){this.started&&this.Render()}},{key:"Update",value:function(){}},{key:"Render",value:function(){}}]),t}(),_=(function(){function t(){n(this,t)}s(t,[{key:"Add",value:function(t,e){for(var i in t){var n=t[i];for(var s in e)this._AddEvent(n,s,e[s])}}},{key:"Remove",value:function(t,e){for(var i in t){var n=t[i];for(var s in e)this._RemoveEvent(n,s,e[s])}}},{key:"_AddEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)}},{key:"_RemoveEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):delete t["on"+e])}}])}(),function(t,e,i){null!=t&&void 0!==t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)}),x=function(t,e,i){null!=t&&void 0!==t&&(t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):delete t["on"+e])},p=function(t){function e(t){var i=t.id,s=t.canvas,o=void 0===s?null:s;n(this,e);var r=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._currScene=null,r.id=i,r.ctx=r._WebGLContext(o),_(window,"resize",function(t){return r.Resize(t)}),r}return r(e,t),s(e,[{key:"_WebGLContext",value:function(t){this.canvas=t;var e=null;if(null==this.canvas)return console.log("No canvas"),null;for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<i.length;++n){try{e=this.canvas.getContext(i[n])}catch(t){}if(e)break}return null==e?(console.log("WebGL Initializing Fail"),null):e}},{key:"Start",value:function(){if(null==this._currScene)return void console.log("Scene is Empty!");o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Start",this).call(this),this._currScene.Start()}},{key:"Update",value:function(){this._currScene.Update()}},{key:"Render",value:function(){this._currScene.Render()}},{key:"Stop",value:function(){this._currScene.Stop(),o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Stop",this).call(this),x(window,"resize")}},{key:"Resize",value:function(t){this._currScene.Resize(t)}},{key:"scene",get:function(){return this._currScene},set:function(t){this.Pause(),null==t?null!=this._currScene&&this._currScene.Stop():this._currScene=new t(this.ctx),this.Resume()}}]),e}(f),d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=e,this.y=i}return s(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"distanceTo",value:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"lenSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.lenSq())}}]),t}(),m=function(){function t(e){n(this,t),this.stage=e,this._eventStoreList={}}return s(t,[{key:"Add",value:function(t,e,i){null!=i&&(e.parentId=i),this._eventStoreList[t]=e}},{key:"Remove",value:function(t){delete this._eventStoreList[t]}},{key:"FindItems",value:function(t){return this.stage.scene.getCollisionObject(new d(t.x,t.y))}},{key:"FindItemOne",value:function(t){var e=this.stage.scene.getCollisionObject(new d(t.x,t.y),1);return e.length>0?e[0]:null}},{key:"Trigger",value:function(t,e,i){if(null!=t)for(var n in this._eventStoreList)if(n==t.id){var s=this._eventStoreList[n],o=s[e];void 0!==s.parentId&&(t.parentId=s.parentId),void 0!==o&&o.call(t,this.stage,i),void 0!==s._after&&s._after.call(t,this.stage,i)}}},{key:"AddEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)}},{key:"RemoveEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):delete t["on"+e])}}]),t}(),k=function(){function t(e){function i(t,e){var i={x:0,y:0};return i.x=t.x-e.x,i.y=t.y-e.y,i}function s(t){var e=v.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function o(t){return function(e){if(e.touches.length>0&&t(e.touches[0]))return e.preventDefault(),!1}}function r(t){var e=s(t);if(null!=(l=f.FindItemOne(e))){u=l.GetCenter(),y=i(e,c=u),window.addEventListener("mousemove",h,!1),window.addEventListener("mouseup",a,!1);var n={event:t};f.Trigger(l,"mousedown",n)}t.preventDefault()}function h(t){var e=s(t),n=f.FindItemOne(e);if(v.style.cursor=n||l?"move":"default",null!=l){var o=i(e,y),r=i(o,c);c=o;var h={offset:r,event:t};return f.Trigger(l,"mousemove",h),t.preventDefault(),!0}}function a(t){var e={event:t};u&&c&&u.x==c.x&&u.y==c.y?f.Trigger(l,"click",e):f.Trigger(l,"mouseup",e),l=null,window.removeEventListener("mousemove",h,!1),window.removeEventListener("mouseup",a,!1),t.preventDefault()}n(this,t);var u,c,l,y,v=e.canvas,f=e.EventStore;v.width,v.height,v.onmousedown=r,v.ontouchstart=o(r),v.onmousemove=h,v.ontouchmove=o(h),v.onmouseup=a,v.ontouchup=o(a)}return s(t,[{key:"AddEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)}},{key:"RemoveEvent",value:function(t,e,i){null!=t&&void 0!==t&&(t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):delete t["on"+e])}}]),t}(),g=function(t){function e(t){var i=t.id,s=t.canvas,o=void 0===s?null:s;n(this,e);var r=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._currScene=null,r.id=i,r.ctx=r._GetContext(o),r.EventStore=new m(r),r.EventStore.AddEvent(window,"resize",function(t){return r.Resize(t)}),r.control=new k(r),r}return r(e,t),s(e,[{key:"_GetContext",value:function(t){this.canvas=t;var e=null;if(null==this.canvas)return console.log("No canvas"),null;try{e=this.canvas.getContext("2d")}catch(t){}return null==e?(console.log("Canvas Initializing Fail"),null):e}},{key:"Start",value:function(){if(null==this._currScene)return void console.log("Scene is Empty!");o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Start",this).call(this),this._currScene.Start()}},{key:"Update",value:function(){this._currScene.Update()}},{key:"Render",value:function(){this._currScene.Render()}},{key:"Stop",value:function(){this._currScene.Stop(),o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Stop",this).call(this),RemoveEvent(window,"resize")}},{key:"Resize",value:function(t){this._currScene.Resize(t)}},{key:"scene",get:function(){return this._currScene},set:function(t){null==t?null!=this._currScene&&this._currScene.Stop():this._currScene=new t(this.ctx)}}]),e}(f),z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.isVec3=!0,this.x=e,this.y=i,this.z=s}return s(t,[{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clamp",value:function(t,e){return this.x=Math.min(e.x,Math.max(t.x,this.x)),this.y=Math.min(e.y,Math.max(t.y,this.y)),this.z=Math.min(e.z,Math.max(t.z,this.z)),this}},{key:"angleTo",value:function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z,i=t.x*t.x+t.y*t.y+t.z*t.z,n=this.dot(t)/Math.sqrt(e*i);return Math.acos(Math.min(1,Math.max(-1,n)))}},{key:"distanceTo",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)}},{key:"dot",value:function(t){return t.x*this.x+t.y*this.y+t.z*this.z}},{key:"cross",value:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this}},{key:"crossVec",value:function(t,e){var i=t.x,n=t.y,s=t.z;return this.x=n*e.z-s*e.y,this.y=s*e.x-i*e.z,this.z=i*e.y-n*e.x,this}},{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"add",value:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t,e){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t,e){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele,o=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*o,this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z,h=t.w,a=h*e+o*n-r*i,u=h*i+r*e-s*n,c=h*n+s*i-o*e,l=-s*e-o*i-r*n;return this.x=a*h+l*-s+u*-r-c*-o,this.y=u*h+l*-o+c*-s-a*-r,this.z=c*h+l*-r+a*-o-u*-s,this}},{key:"transformDirection",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.ele;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clampScalar",value:function(e,i){return this.clamp(new t(e,e,e),new t(i,i,i))}},{key:"clampLength",value:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"projectOnVector",value:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixPosition",value:function(t){var e=t.ele;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.ele,4*e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}]),t}(),M=function(){function t(){n(this,t),this.type="Camera2D",this.isCamera=!0}return s(t,[{key:"copy",value:function(e,i){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"copy",this).call(this,this,e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getWorldDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new z,e=this.quat;return this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}},{key:"updateMatrixWorld",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)}}]),t}(),S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new d(0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d(0,0);n(this,t),this.min=e,this.max=i}return s(t,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"setFromXYWH",value:function(t){this.min.x=t.x,this.min.y=t.y,this.max.x=t.width+t.x,this.max.y=t.height+t.y}},{key:"setFromPoints",value:function(t){for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new d(0,0);return this.isEmpty()?t.set(this.max.x,this.min.y):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new d(0,0);return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d).copy(t).clamp(this.min,this.max)}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.id=e.id||Math.random(),this._position=null,this.originalPosition=null,this.attachs={},this.hide=!1,this.originalColor=e.color||"#000000",this.color=e.color||"#000000",this.lineColor=e.color||e.lineColor||"#000000","DASH"==e.lineType?this.lineType=[15,5]:"DOT"==e.lineType?this.lineType=[5,5]:this.lineType=e.lineType,this.lineWidth=e.lineWidth||1,this.opacity=e.opacity||1}return s(t,[{key:"Hide",value:function(){this.hide=!0}},{key:"Show",value:function(){this.hide=!1}},{key:"ChangeColor",value:function(t){this.color=t}},{key:"Translate",value:function(){this._executeAttachs()}},{key:"Destroy",value:function(){delete this._position,delete this.originalPosition}},{key:"SetScale",value:function(){}},{key:"Update",value:function(t){}},{key:"Render",value:function(t){t.strokeStyle=this.lineColor,t.lineWidth=this.lineWidth,null!=this.lineType&&t.setLineDash(this.lineType),this.opacity<1&&(t.globalAlpha=this.opacity)}},{key:"Attach",value:function(t,e){this.attachs[t]=e}},{key:"Detach",value:function(t){delete this.attachs[t]}},{key:"_executeAttachs",value:function(t){for(var e in this.attachs){var i=this.attachs[e];if(this._position instanceof d)null!=i.min&&(this._setDataInAttachs(i.min.x,this._position,"x"),this._setDataInAttachs(i.min.y,this._position,"y"));else if(this._position instanceof S)null!=i.min&&(this._setDataInAttachs(i.min.x,this._position.min,"x"),this._setDataInAttachs(i.min.y,this._position.min,"y")),null!=i.max&&(this._setDataInAttachs(i.max.x,this._position.max,"x"),this._setDataInAttachs(i.max.y,this._position.max,"y"));else if(this._position instanceof Array)for(var n in i)"min"==n?(this._setDataInAttachs(i.min.x,this._position[0],"x"),this._setDataInAttachs(i.min.y,this._position[0],"y")):"max"==n?(this._setDataInAttachs(i.max.x,this._position[this._position.length-1],"x"),this._setDataInAttachs(i.max.y,this._position[this._position.length-1],"y")):(this._setDataInAttachs(i[n].x,this._position[n],"x"),this._setDataInAttachs(i[n].y,this._position[n],"y"));if(t==this.id)return;if(void 0==t&&(t=this.id),void 0!=i._next){var s=i._next;if(s instanceof Array)for(var o in s)s[o]._executeAttachs(t);else s._executeAttachs(t)}}this.SetScale()}},{key:"_setDataInAttachs",value:function(t,e,i){if(t instanceof Array)for(var n in t)t[n][i]=e[i];else t[i]=e[i]}}]),t}(),b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.id=e.id||Math.random(),this.eventStore=void 0,this.hide=!1}return s(t,[{key:"Hide",value:function(){this.hide=!0}},{key:"Show",value:function(){this.hide=!1}},{key:"CollisionCheck",value:function(t){return this._shape.CollisionCheck(t)}},{key:"Picker",value:function(t){}},{key:"Update",value:function(t){}},{key:"Render",value:function(t){}},{key:"Destroy",value:function(){}}]),t}(),C=function(){function t(e){n(this,t),this.stage=e,this.ctx=e.ctx,this.width=e.canvas.width,this.height=e.canvas.height,this.EventStore=e.EventStore,this.Units={},this.Items={}}return s(t,[{key:"_World",value:function(t){}},{key:"Remove",value:function(t){var e=this.Items[t];if(null!=e){if(e instanceof b)for(var i in e){var n=e[i];n instanceof w&&(this.Units[n.id].Destroy(),delete this.Units[n.id],void 0!==n.eventStore&&this.EventStore.Remove(n.id))}else e instanceof w&&(this.Units[t].Destroy(),delete this.Units[t],this.EventStore.Remove(t));this.Items[t].Destroy(),delete this.Items[t]}}},{key:"Add",value:function(t){if(t.id=Math.random(),t instanceof M)console.log("camera");else if(t instanceof w)this.Items[t.id]=t,this.Units[t.id]=t,void 0!==t.eventStore&&this.EventStore.Add(t.id,t.eventStore);else if(t instanceof b){this.Items[t.id]=t;for(var e in t){var i=t[e];i instanceof w&&(this.Units[i.id]=i,void 0!==i.eventStore&&this.EventStore.Add(i.id,i.eventStore,t.id))}}return t.id}},{key:"getCollisionObject",value:function(t,e){var i=[],n=0;for(var s in this.Units){var o=this.Units[s];if(1!=o.hide&&(!0===o.CollisionCheck(t)&&(i.push(o),n++),null!=e&&e<=n))return i}return i}},{key:"Start",value:function(){}},{key:"Update",value:function(){for(var t in this.Items)this.Items[t].Update(this.ctx)}},{key:"Render",value:function(){this.ctx.clearRect(0,0,this.width,this.height);for(var t in this.Items){var e=this.Items[t];1!=e.hide&&e.Render(this.ctx)}}},{key:"Stop",value:function(){}},{key:"Resize",value:function(t){this.width=this.stage.canvas.width,this.height=this.stage.canvas.height,this.Render()}}]),t}(),R=function(){function t(){n(this,t),this.ARG_LENGTH={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0}}return s(t,[{key:"_parseValues",value:function(t){var e=t.match(/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi);return e?e.map(Number):[]}},{key:"Parse",value:function(t){var e=this,i=[],n=String(t).trim();return"M"!==n[0]&&"m"!==n[0]?i:(n.replace(/([astvzqmhlc])([^astvzqmhlc]*)/gi,function(t,n,s){var o=n.toLowerCase(),r=e._parseValues(s),h=n;if("m"===o&&r.length>2&&(i.push([h].concat(r.splice(0,2))),o="l",h="m"===h?"l":"L"),r.length<e.ARG_LENGTH[o])return"";for(i.push([h].concat(r.splice(0,e.ARG_LENGTH[o])));r.length>=e.ARG_LENGTH[o]&&r.length&&e.ARG_LENGTH[o];)i.push([h].concat(r.splice(0,e.ARG_LENGTH[o])));return""}),i)}}]),t}(),P=function(){function t(e){n(this,t),this.segments=[];var i=new R;this.segments=i.Parse(e)}return s(t,[{key:"Render",value:function(t){this.buildPath(t,this.segments)}},{key:"_rotatePoint",value:function(t,e){var i=t.x*Math.cos(e)-t.y*Math.sin(e),n=t.y*Math.cos(e)+t.x*Math.sin(e);t.x=i,t.y=n}},{key:"_translatePoint",value:function(t,e,i){t.x+=e,t.y+=i}},{key:"_scalePoint",value:function(t,e){t.x*=e,t.y*=e}},{key:"moveTo",value:function(t,e){this.segments.push(["M",t,e])}},{key:"lineTo",value:function(t,e){this.segments.push(["L",t,e])}},{key:"arc",value:function(t,e,i,n,s,o){this.segments.push(["AC",t,e,i,n,s,!!o])}},{key:"arcTo",value:function(t,e,i,n,s){this.segments.push(["AT",t,e,i,n,s])}},{key:"ellipse",value:function(t,e,i,n,s,o,r,h){this.segments.push(["E",t,e,i,n,s,o,r,!!h])}},{key:"closePath",value:function(){this.segments.push(["Z"])}},{key:"bezierCurveTo",value:function(t,e,i,n,s,o){this.segments.push(["C",t,e,i,n,s,o])}},{key:"quadraticCurveTo",value:function(t,e,i,n){this.segments.push(["Q",t,e,i,n])}},{key:"rect",value:function(t,e,i,n){this.segments.push(["R",t,e,i,n])}},{key:"buildPath",value:function(t,e){var i=void 0,n=void 0,s=void 0,o=void 0,r=void 0,h=void 0,a=void 0,u=void 0,c=void 0,l=void 0,y=void 0,v=void 0,f=void 0,_=void 0,x=void 0,p=void 0,d=void 0,m=void 0,k=void 0,g=void 0,z=void 0,M=void 0,S=void 0,w=void 0,b=void 0,C=void 0,R={x:0,y:0},P={x:0,y:0};t.beginPath();for(var E=0;E<e.length;++E){var A=e[E];"S"!==(g=A[0])&&"s"!==g&&"C"!==g&&"c"!==g&&(M=null,S=null),"T"!==g&&"t"!==g&&"Q"!==g&&"q"!==g&&(w=null,b=null),"M"==g||"m"==g?("m"===g?(y+=A[1],f+=A[2]):(y=A[1],f=A[2]),"M"!==g&&R||(R={x:y,y:f}),t.moveTo(y,f)):"l"==g?(y+=A[1],f+=A[2],t.lineTo(y,f)):"L"==g?(y=A[1],f=A[2],t.lineTo(y,f)):"h"==g?(y+=A[1],t.lineTo(y,f)):"H"==g?(y=A[1],t.lineTo(y,f)):"v"==g?(f+=A[1],t.lineTo(y,f)):"V"==g?(f=A[1],t.lineTo(y,f)):"A"==g||"a"==g?("a"===g?(y+=A[6],f+=A[7]):(y=A[6],f=A[7]),p=A[1],d=A[2],a=A[3]*Math.PI/180,s=!!A[4],o=!!A[5],r={x:y,y:f},h={x:(P.x-r.x)/2,y:(P.y-r.y)/2},this._rotatePoint(h,-a),(u=h.x*h.x/(p*p)+h.y*h.y/(d*d))>1&&(p*=u=Math.sqrt(u),d*=u),z={x:p*h.y/d,y:-d*h.x/p},c=p*p*d*d,l=p*p*h.y*h.y+d*d*h.x*h.x,o!==s?this._scalePoint(z,Math.sqrt((c-l)/l)||0):this._scalePoint(z,-Math.sqrt((c-l)/l)||0),n=Math.atan2((h.y-z.y)/d,(h.x-z.x)/p),i=Math.atan2(-(h.y+z.y)/d,-(h.x+z.x)/p),this._rotatePoint(z,a),this._translatePoint(z,(r.x+P.x)/2,(r.y+P.y)/2),t.save(),t.translate(z.x,z.y),t.rotate(a),t.scale(p,d),t.arc(0,0,1,n,i,!o),t.restore()):"c"==g?(t.bezierCurveTo(A[1]+y,A[2]+f,A[3]+y,A[4]+f,A[5]+y,A[6]+f),M=A[3]+y,S=A[4]+f,y+=A[5],f+=A[6]):"C"==g?(M=A[3],S=A[4],y=A[5],f=A[6],t.bezierCurveTo(A[1],A[2],M,S,y,f)):"s"==g?(null!==M&&null!==M||(M=y,S=f),t.bezierCurveTo(2*y-M,2*f-S,A[1]+y,A[2]+f,A[3]+y,A[4]+f),M=A[1]+y,S=A[2]+f,y+=A[3],f+=A[4]):"S"==g?(null!==M&&null!==M||(M=y,S=f),t.bezierCurveTo(2*y-M,2*f-S,A[1],A[2],A[3],A[4]),M=A[1],S=A[2],y=A[3],f=A[4]):"q"==g?(w=A[1]+y,b=A[2]+f,y+=A[3],f+=A[4],t.quadraticCurveTo(w,b,y,f)):"Q"==g?(w=A[1],b=A[2],y=A[3],f=A[4],t.quadraticCurveTo(w,b,y,f)):"t"==g?(null!==w&&null!==w||(w=y,b=f),w=2*y-w,b=2*f-b,y+=A[1],f+=A[2],t.quadraticCurveTo(w,b,y,f)):"T"==g?(null!==w&&null!==w||(w=y,b=f),w=2*y-w,b=2*f-b,y=A[1],f=A[2],t.quadraticCurveTo(w,b,y,f)):"z"==g||"Z"==g?(y=R.x,f=R.y,R=void 0,t.closePath()):"AC"==g?(y=A[1],f=A[2],x=A[3],n=A[4],i=A[5],C=A[6],t.arc(y,f,x,n,i,C)):"AT"==g?(v=A[1],_=A[2],y=A[3],f=A[4],x=A[5],t.arcTo(v,_,y,f,x)):"E"==g?(y=A[1],f=A[2],p=A[3],d=A[4],a=A[5],n=A[6],i=A[7],C=A[8],t.save(),t.translate(y,f),t.rotate(a),t.scale(p,d),t.arc(0,0,1,n,i,C),t.restore()):"R"==g?(y=A[1],f=A[2],m=A[3],k=A[4],R={x:y,y:f},t.rect(y,f,m,k)):console.log(g+"is not implemented"),P.x=y,P.y=f}}}]),t}(),E=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._position=new S,i._position.setFromXYWH(t),i.originalPosition=new S,i.originalPosition.setFromXYWH(t),i.scale=[1,1],i}return r(e,t),s(e,[{key:"SetScale",value:function(){var t=this.originalPosition.getSize(),e=this._position.getSize();this.scale[0]=e.x/t.x,this.scale[1]=e.y/t.y}},{key:"GetCenter",value:function(){return this._position.getCenter()}},{key:"Translate",value:function(t){this._position.translate(t),o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Translate",this).call(this)}},{key:"Render",value:function(t){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Render",this).call(this,t);var i=this._position.min,n=this._position.getSize();null!=this.color&&(t.fillStyle=this.color,t.fillRect(i.x,i.y,n.x,n.y)),t.strokeRect(i.x,i.y,n.x,n.y)}},{key:"CollisionCheck",value:function(t){return t instanceof d?this._position.containsPoint(t):t instanceof e?this._position.containsPoint(t._position):t instanceof S&&this._position.containsBox(t)}}]),e}(w),A=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._position=new d(t.x,t.y),i.originalPosition=new d(t.x,t.y),i.radius=t.radius||5,i}return r(e,t),s(e,[{key:"set",value:function(t,e){this._position=new d(t,e)}},{key:"GetCenter",value:function(){return this._position}},{key:"Translate",value:function(t){this._position.add(t),o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Translate",this).call(this)}},{key:"Update",value:function(){}},{key:"Render",value:function(t){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Render",this).call(this,t),t.beginPath(),t.arc(this._position.x,this._position.y,this.radius,0,2*Math.PI,!1),t.fillStyle=this.color,t.fill(),t.stroke()}},{key:"CollisionCheck",value:function(t){var i=this._position.clone();if(t instanceof d){var n=i.sub(t).lenSq();if(n<1/0&&n<this.radius*this.radius)return!0}else if(t instanceof e){var s=i.sub(t._position).lenSq();if(s<1/0&&s<this.radius*this.radius)return!0}else if(t instanceof S)return t.containsPoint(this._position);return!1}}]),e}(w),O=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(null==t.pos||t.pos.length<2)return console.error("[pos] is not valid"),h(i);i._position=[];for(var s=0;s<t.pos.length;s++)t.pos[s]instanceof d?i._position[s]=t.pos[s]:t.pos[s]instanceof Array&&(i._position[s]=new d(t.pos[s][0],t.pos[s][1]));return i.isBezier=t.isBezier||!1,i}return r(e,t),s(e,[{key:"Render",value:function(t){if(o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Render",this).call(this,t),t.beginPath(),this.isBezier){for(var i=[],n=0;n<this._position.length;n++)0==n?t.moveTo(this._position[0].x,this._position[0].y):(i.push(this._position[n].x),i.push(this._position[n].y));t.bezierCurveTo.apply(t,i)}else for(var s=0;s<this._position.length;s++)0==s?t.moveTo(this._position[0].x,this._position[0].y):t.lineTo(this._position[s].x,this._position[s].y);t.stroke(),t.closePath()}},{key:"CollisionCheck",value:function(t){return!1}}]),e}(w),T=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._shape=new A(t),i._shape.eventStore={mousedown:function(t,e){this.ChangeColor("#ff0000")},mouseup:function(t){this.ChangeColor(this.originalColor)},mousemove:function(t,e){this.Translate(e.offset),t.Render()},click:function(t,e){console.log(this.parentId),t.scene.Remove(this.parentId),t.Render()}},i}return r(e,t),s(e,[{key:"Render",value:function(t){this._shape.Render(t)}}]),e}(b),D=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._shape=new E(t),i._shape.eventStore={mousedown:function(t,e){this.ChangeColor("#ff0000")},mouseup:function(t,e){this.ChangeColor(this.originalColor)},mousemove:function(t,e){this.Translate(e.offset)},click:function(t,e){t.scene.Remove(this.parentId)},_afterCallback:function(t,e){t.Render()}},i}return r(e,t),s(e,[{key:"Render",value:function(t){0==this._shape.hide&&this._shape.Render(t)}}]),e}(b),I=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.controlRect=new E(t),i.text=t.text,i}return r(e,t),s(e,[{key:"Update",value:function(t){}},{key:"Render",value:function(t){t.fillText(this.text,10,10)}}]),e}(b),L=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i._c1=new A,i._c2=new A,i._c3=new A,i._c4=new A,i._rect=new E(t),i._c1.set(i._rect._position.min.x,i._rect._position.min.y),i._c2.set(i._rect._position.max.x,i._rect._position.min.y),i._c3.set(i._rect._position.min.x,i._rect._position.max.y),i._c4.set(i._rect._position.max.x,i._rect._position.max.y),i._rect.Attach(i.id,{min:{x:[i._c1._position,i._c3._position],y:[i._c1._position,i._c2._position]},max:{x:[i._c2._position,i._c4._position],y:[i._c3._position,i._c4._position]}}),i._c1.Attach(i.id,{min:{x:i._rect._position.min,y:i._rect._position.min},_next:[i._rect]}),i._c2.Attach(i.id,{min:{x:i._rect._position.max,y:i._rect._position.min},_next:[i._rect]}),i._c3.Attach(i.id,{min:{x:i._rect._position.min,y:i._rect._position.max},_next:[i._rect]}),i._c4.Attach(i.id,{min:{x:i._rect._position.max,y:i._rect._position.max},_next:[i._rect]}),i._rect.eventStore={mousemove:function(t,e){this.Translate(e.offset)},click:function(t,e){t.scene.Remove(this.parentId)},_after:function(t,e){t.Render()}};var s={mousemove:function(t,e){this.Translate(e.offset),t.Render()}};return i._c1.eventStore=s,i._c2.eventStore=s,i._c3.eventStore=s,i._c4.eventStore=s,i}return r(e,t),s(e,[{key:"Render",value:function(t){this._rect.Render(t),this._c1.Render(t),this._c2.Render(t),this._c3.Render(t),this._c4.Render(t)}}]),e}(b),q=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i._rect=new E(t),i._c1=new A,i._c2=new A,i._c3=new A,i._c4=new A,i._c1.set(i._rect._position.min.x,i._rect._position.min.y),i._c2.set(i._rect._position.max.x,i._rect._position.min.y),i._c3.set(i._rect._position.min.x,i._rect._position.max.y),i._c4.set(i._rect._position.max.x,i._rect._position.max.y),i._line=new O({pos:[i._c1._position,i._c2._position,i._c3._position,i._c4._position],isBezier:!0,lineType:"DASH",lineWidth:5}),i._rect.Attach(i.id,{min:{x:[i._line._position[0],i._line._position[2],i._c1._position,i._c3._position],y:[i._line._position[0],i._line._position[1],i._c1._position,i._c2._position]},max:{x:[i._line._position[1],i._line._position[3],i._c2._position,i._c4._position],y:[i._line._position[2],i._line._position[3],i._c3._position,i._c4._position]}}),i._c1.Attach(i.id,{min:{x:[i._rect._position.min,i._line._position[0]],y:[i._rect._position.min,i._line._position[0]]},_next:[i._rect]}),i._c2.Attach(i.id,{min:{x:[i._rect._position.max,i._line._position[1]],y:[i._rect._position.min,i._line._position[1]]},_next:[i._rect]}),i._c3.Attach(i.id,{min:{x:[i._rect._position.min,i._line._position[2]],y:[i._rect._position.max,i._line._position[2]]},_next:[i._rect]}),i._c4.Attach(i.id,{min:{x:[i._rect._position.max,i._line._position[3]],y:[i._rect._position.max,i._line._position[3]]},_next:[i._rect]}),i._rect.eventStore={mousemove:function(t,e){this.Translate(e.offset)},click:function(t,e){t.scene.Remove(this.parentId)},_after:function(t,e){t.Render()}};var s={mousemove:function(t,e){this.Translate(e.offset),t.Render()}};return i._c1.eventStore=s,i._c2.eventStore=s,i._c3.eventStore=s,i._c4.eventStore=s,i}return r(e,t),s(e,[{key:"Render",value:function(t){this._c1.Render(t),this._c2.Render(t),this._c3.Render(t),this._c4.Render(t),this._line.Render(t)}}]),e}(b),j=function(t){function e(t){n(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.path2d=new Path2D("M118.148,0H19.237c-3.318,0-6.438,0.851-9.155,2.342C4.087,5.525,0,11.825,0,19.086\n\t\t c0,7.935,4.88,14.722,11.799,17.547c2.286,0.969,4.8,1.506,7.438,1.506h98.911c10.532,0,19.069-8.537,19.069-19.07\n\t\t C137.218,8.539,128.681,0,118.148,0z M22.549,25.047c-0.006,0.005-0.011,0.01-0.016,0.016l-2.842,2.818\n\t\t c-2.507,2.488-6.587,2.488-9.093,0c-2.506-2.485-2.506-6.533,0-9.02l1.569-1.558c0.416-0.412,1.133-0.138,1.155,0.445\n\t\t c0.027,0.744,0.162,1.491,0.409,2.213c0.084,0.243,0.023,0.515-0.16,0.696l-0.553,0.55c-1.186,1.176-1.224,3.091-0.05,4.278\n\t\t c1.187,1.199,3.134,1.207,4.328,0.021l2.843-2.819c1.192-1.183,1.188-3.095,0-4.273c-0.157-0.154-0.314-0.275-0.438-0.358\n\t\t c-0.155-0.107-0.287-0.344-0.294-0.529c-0.017-0.444,0.142-0.9,0.495-1.251l0.89-0.885c0.234-0.231,0.601-0.259,0.871-0.072\n\t\t c0.257,0.179,0.646,0.502,0.868,0.722C25.06,18.552,25.025,22.574,22.549,25.047z M25.77,20.26\n\t\t c-0.027-0.744-0.162-1.491-0.409-2.213c-0.084-0.243-0.023-0.515,0.159-0.696l0.554-0.55c1.186-1.176,1.224-3.091,0.05-4.279\n\t\t c-1.187-1.198-3.135-1.206-4.328-0.021l-2.843,2.819c-1.192,1.183-1.188,3.095,0,4.273c0.157,0.154,0.313,0.275,0.438,0.359\n\t\t c0.155,0.105,0.287,0.343,0.294,0.528c0.017,0.443-0.142,0.9-0.495,1.251l-0.89,0.885c-0.233,0.23-0.601,0.259-0.871,0.072\n\t\t c-0.257-0.179-0.646-0.502-0.868-0.722c-2.526-2.511-2.492-6.533-0.015-9.005c0.005-0.006,0.011-0.011,0.015-0.017l2.842-2.818\n\t\t c2.507-2.488,6.587-2.488,9.093,0c2.507,2.485,2.507,6.533,0,9.02l-1.569,1.558C26.509,21.117,25.791,20.843,25.77,20.26z\n\t\t  M117.833,35.457H28.478c5.635-3.285,9.432-9.378,9.432-16.371c0-7.015-3.82-13.125-9.485-16.402h89.409\n\t\t c9.051,0,16.387,7.336,16.387,16.387S126.884,35.457,117.833,35.457z"),i}return r(e,t),s(e,[{key:"Destroy",value:function(){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Destroy",this).call(this),delete this.path2d}},{key:"Render",value:function(t){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Render",this).call(this,t),t.save(),t.fillStyle=this.color,t.translate(this._rect._position.min.x,this._rect._position.min.y),t.scale(this._rect.scale[0],this._rect.scale[1]),this.path2d.Render(t),t.fill(),t.restore()}}]),e}(L);e.ShaderProgram=a,e.Scene=v,e.Stage=p,e.Stage2D=g,e.Scene2D=C,e.Path2D=P,e.Item=b,e.Rect=E,e.Point=A,e.Line=O,e.Point2D=T,e.Rect2D=D,e.TextBox2D=I,e.EditRect2D=L,e.BezierLine2D=q,e.Svg2D=j,e.MouseControl=k});!function(t){t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")&&t.default}(e);e.ShaderProgram;var i=e.Scene,n=e.Stage,s=(e.Stage2D,e.Scene2D,e.Path2D,e.Item,e.Rect,e.Point,e.Line,e.Point2D,e.Rect2D,e.TextBox2D,e.EditRect2D,e.BezierLine2D,e.Svg2D,e.MouseControl,function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in s)return s.value;var r=s.get;if(void 0!==r)return r.call(n)},h=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(t){function e(t){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,t),e}(i),c=function(t){function e(t){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{id:"Stage01",scenes:{Scene01:u},currScene:"Scene01",canvas:t}))}return h(e,t),o(e,[{key:"Update",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"Update",this).call(this)}},{key:"Destroy",value:function(){this.Stop()}}]),e}(n);t.Stage01=c,Object.defineProperty(t,"__esModule",{value:!0})});
